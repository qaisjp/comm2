<div>
  <h2>Version History</h2>
  <ng-template #packagesLoading>
    <div>Loading...</div>
  </ng-template>

  <ng-container *ngIf="view.packages$ | async as packages; else packagesLoading">

    <div>
      <div *ngFor="let pkg of packages" class="TimelineItem">
        <div class="TimelineItem-badge"><i appOcticon="git-commit" class="mr-0"></i></div>
        <div class="TimelineItem-body d-flex flex-column flex-lg-row">
          <div class="d-flex flex-column mr-2 flex-items-center flex-lg-items-baseline" style="flex: 0 1 auto;">
            <div>
              {{ pkg.version }}
              {{ pkg.draft ? 'updated' : 'published' }} at
              {{ (pkg.draft ? pkg.updated_at : pkg.created_at) | amDateFormat: 'YYYY-MM-DD HH:mm' }}
            </div>
            <div class="d-flex mt-1">
              <button class="btn btn-sm" (click)="view.download(pkg).subscribe()"
                      [title]="pkg.file_uploaded ? null : 'No file has been uploaded'"
                      [disabled]="!pkg.file_uploaded">Download
              </button>
              <button class="btn btn-sm mx-1" (click)="view.download(pkg).subscribe()"
                      [title]="pkg.file_uploaded ? null : 'No file has been uploaded'"
                      [disabled]="!pkg.file_uploaded">Contents
              </button>
              <button class="btn btn-sm" [routerLink]="['edit', pkg.id]">Edit</button>
            </div>
          </div>

          <div style="flex: 1;" class="mt-2 mt-lg-0">
            <ng-container *ngIf="pkg.description.length > 0" #defaultPkgDescription>
              {{ pkg.description }} {{ pkg.description }} {{ pkg.description }}
            </ng-container>
            <ng-template #defaultPkgDescription><em>no description provided</em></ng-template>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</div>
